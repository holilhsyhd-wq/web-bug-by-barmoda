<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>barmods-X-delta</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#07060b;
  --card:#0f0f1a;
  --accent:#9f00ff;
  --muted:#cfd3ff;
  --glass: rgba(255,255,255,0.03);
  --danger:#ff6b6b;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#05050a 0%, #0b0b10 100%);color:var(--muted);-webkit-font-smoothing:antialiased}
.app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.card{width:100%;max-width:1100px;border-radius:14px;padding:0;overflow:hidden;border:1px solid rgba(159,0,255,0.06);box-shadow:0 20px 60px rgba(0,0,0,0.6);background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));}

/* Loading fullscreen overlay */
#interaction-screen, #loading-screen {
  position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:#000; z-index:9999;
}
#interaction-screen{cursor:pointer}
#loading-screen{display:none;flex-direction:column;gap:12px;padding:20px}

/* Login area */
.login-wrap{display:flex;gap:0;align-items:stretch}
.login-panel{width:380px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:28px;border-right:1px solid rgba(255,255,255,0.02);}
.login-panel h2{margin:0 0 12px;color:var(--accent);font-size:1.4rem}
.input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:var(--muted);margin-bottom:12px}
.btn{display:inline-block;padding:12px 14px;border-radius:10px;background:var(--accent);color:#fff;font-weight:700;border:none;cursor:pointer}
.small{font-size:0.85rem;color:rgba(191,192,230,0.7)}

/* Main dashboard */
.dashboard{flex:1;padding:18px;display:flex;flex-direction:column;gap:12px}
.header-banner{width:100%;height:180px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(90deg, rgba(159,0,255,0.04), rgba(159,0,255,0.01));display:flex;align-items:center;justify-content:center}
.header-banner img{width:100%;height:100%;object-fit:cover;display:block}
.top-row{display:flex;gap:12px}
.col{background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);flex:1;min-height:160px}
.col.wide{flex:2}
.label{display:block;font-size:0.9rem;color:rgba(191,192,230,0.9);margin-bottom:8px}
.input-inline{display:flex;gap:8px}
.select,input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:var(--muted)}
textarea{min-height:120px;resize:vertical}
.result{background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;border:1px dashed rgba(255,255,255,0.02);min-height:100px;overflow:auto;white-space:pre-wrap;color:var(--muted)}

/* footer */
.footer{font-size:0.85rem;color:rgba(191,192,230,0.6);text-align:center;margin-top:6px}

/* responsive */
@media(max-width:980px){
  .login-panel{width:320px;padding:16px}
  .header-banner{height:140px}
  .top-row{flex-direction:column}
  .app{padding:12px}
}
</style>
</head>
<body>

<!-- Initial click-to-start screen -->
<div id="interaction-screen" title="Klik untuk memulai">
  <div style="text-align:center;color:#fff">
    <div style="font-size:20px;font-weight:700;margin-bottom:8px">Klik untuk memulai</div>
    <div class="small">Tampilkan loading intro sebelum login</div>
  </div>
</div>

<!-- Loading screen with video -->
<div id="loading-screen" aria-hidden="true">
  <video id="intro-video" playsinline preload="auto" style="max-width:90vw;max-height:80vh;border-radius:12px">
    <source src="https://files.catbox.moe/0ik9wn.mp4" type="video/mp4">
    Browser Anda tidak mendukung video.
  </video>
  <div class="small" style="color:#fff">Sedang memuat... tunggu sebentar</div>
</div>

<div class="app" style="display:none" id="app-root">
  <div class="card">
    <div class="login-wrap">

      <!-- Left: login panel -->
      <div class="login-panel" id="login-panel">
        <h2>Login Access</h2>
        <form id="loginForm">
          <input id="username" class="input" type="text" placeholder="Username" required>
          <input id="password" class="input" type="password" placeholder="Password" required>
          <button class="btn" type="submit">Masuk</button>
          <div id="login-error" class="small" style="color:var(--danger);display:none;margin-top:10px">Username atau password salah.</div>
        </form>
        <div style="margin-top:18px" class="small">Username: <strong>barmods</strong> &nbsp; Password: <strong>developer</strong></div>
      </div>

      <!-- Right: dashboard preview (hidden until login) -->
      <div class="dashboard" id="dashboard" style="display:none">
        <div class="header-banner">
          <img id="banner-img" src="https://files.catbox.moe/4wbhkk.jpg" alt="Banner">
        </div>

        <div class="top-row">
          <div class="col" style="max-width:320px">
            <label class="label">Target Number (WA)</label>
            <input id="phone" type="text" placeholder="Contoh: 628123456789">
            <label class="label" style="margin-top:10px">Pilih Template</label>
            <select id="template">
              <option value="">Pilih template</option>
              <option value="halo">crash</option>
              <option value="BARMODS Ampas">BARMODS Ampas</option>
              <option value="delta 2023">delta 2023</option>
              <option value="blank">blank</option>
            </select>
            <div style="margin-top:12px">
              <button id="wa-send" class="btn" style="width:100%">Kirim via WhatsApp</button>
            </div>
          </div>

          <div class="col wide">
            <label class="label">AI Chat (Gemini)</label>
            <textarea id="ai-prompt" placeholder="Contoh: jelaskan apa itu OSINT"></textarea>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="ai-submit" class="btn">Kirim ke AI</button>
              <button id="ai-clear" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Kosongkan</button>
            </div>
            <div style="margin-top:10px">
              <label class="label">Jawaban AI</label>
              <div id="ai-result" class="result">Belum ada prompt.</div>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:12px">
          <div class="col">
            <label class="label">TikTok Downloader</label>
            <input id="tiktok-url" type="url" placeholder="https://www.tiktok.com/...">
            <div style="margin-top:8px;display:flex;gap:8px">
              <button id="tiktok-submit" class="btn">Unduh Tanpa WM</button>
              <button id="tiktok-clear" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Kosongkan</button>
            </div>
            <div style="margin-top:10px">
              <div id="tiktok-result" class="result">Hasil akan tampil di sini.</div>
            </div>
          </div>

          <div class="col">
            <label class="label">OSINT - Lacak Nomor</label>
            <input id="osint-phone" type="text" placeholder="Tempel nomor atau tekan isi dari WA">
            <div style="margin-top:8px">
              <button id="osint-btn" class="btn" style="width:100%">Lacak via Google</button>
            </div>
            <div style="margin-top:12px">
              <label class="label">Informasi</label>
              <div class="small">Setelah login, audio akan diputar otomatis. Jika browser mencegah autoplay, klik tombol play pada kontrol audio di pojok bawah.</div>
            </div>
          </div>
        </div>

        <div class="footer">Deploy di Vercel â€¢ Pastikan set <code>GEMINI_API_KEY</code> di Environment Variables</div>
      </div>

    </div>
  </div>
</div>

<!-- Background audio (attempt autoplay after login) -->
<audio id="bg-audio" loop preload="auto">
  <source src="https://files.catbox.moe/27r5rt.mp3" type="audio/mpeg">
</audio>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  const interaction = document.getElementById('interaction-screen');
  const loading = document.getElementById('loading-screen');
  const introVideo = document.getElementById('intro-video');
  const appRoot = document.getElementById('app-root');
  const loginForm = document.getElementById('loginForm');
  const loginError = document.getElementById('login-error');
  const dashboard = document.getElementById('dashboard');
  const loginPanel = document.getElementById('login-panel');
  const bgAudio = document.getElementById('bg-audio');

  // Start interaction: click to show loading and play video, then show login
  interaction.addEventListener('click', ()=>{
    interaction.style.display = 'none';
    loading.style.display = 'flex';
    introVideo.currentTime = 0;
    introVideo.muted = false;
    const p = introVideo.play();
    if(p && p.catch) {
      p.catch(err=>{
        // fallback: mute and play
        introVideo.muted = true;
        introVideo.play().catch(()=>{});
      });
    }
  }, { once: true });

  // When video ends or errors, show login screen (login panel visible)
  introVideo.onended = showLogin;
  introVideo.onerror = showLogin;

  function showLogin(){
    loading.style.display = 'none';
    appRoot.style.display = 'flex';
    // keep dashboard hidden until login
    loginPanel.style.display = 'block';
    dashboard.style.display = 'none';
  }

  // Handle login with provided credentials
  loginForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value.trim();
    if(user === 'barmods' && pass === 'developer'){
      // success: hide login panel, show dashboard, play audio
      loginError.style.display = 'none';
      loginPanel.style.display = 'none';
      dashboard.style.display = 'block';
      // try to autoplay audio
      const playPromise = bgAudio.play();
      if(playPromise !== undefined){
        playPromise.catch(err=>{
          console.warn('Autoplay audio gagal:', err);
          // do nothing, user can interact to enable audio
        });
      }
    } else {
      loginError.style.display = 'block';
    }
  });

  // Utility to clean phone numbers
  function cleanPhoneNumber(phone){
    if(!phone) return '';
    let clean = phone.replace(/\D/g,'');
    if(clean.startsWith('0')) clean = '62' + clean.substring(1);
    else if(!clean.startsWith('62')) clean = '62' + clean;
    return clean;
  }

  // WhatsApp send
  document.getElementById('wa-send').addEventListener('click', ()=>{
    const phone = document.getElementById('phone').value;
    const template = document.getElementById('template').value || '';
    const clean = cleanPhoneNumber(phone);
    if(!clean){ alert('Masukkan nomor target.'); return; }
    document.getElementById('osint-phone').value = clean;
    // If template equals 'halo' (for crash), send "halo"
    const message = template === 'halo' ? 'halo' : template;
    const encoded = encodeURIComponent(message);
    const url = `https://wa.me/${clean}?text=${encoded}`;
    window.open(url, '_blank');
  });

  // OSINT button
  document.getElementById('osint-btn').addEventListener('click', ()=>{
    const phone = document.getElementById('osint-phone').value;
    if(!phone){ alert('Masukkan nomor telepon.'); return; }
    const clean = cleanPhoneNumber(phone);
    const query = `("${clean}" OR "0${clean.substring(2)}")`;
    const sites = ['facebook.com','instagram.com','tiktok.com','twitter.com','linkedin.com','getcontact.com','truecaller.com'].map(s=>`site:${s}`).join(' OR ');
    const finalQuery = `(${query}) AND (${sites})`;
    window.open('https://www.google.com/search?q='+encodeURIComponent(finalQuery),'_blank');
  });

  // TikTok downloader
  document.getElementById('tiktok-submit').addEventListener('click', async ()=>{
    const url = document.getElementById('tiktok-url').value.trim();
    const result = document.getElementById('tiktok-result');
    if(!url){ result.innerText = 'Masukkan URL TikTok terlebih dahulu.'; return; }
    result.innerText = 'Memproses...';
    try {
      const resp = await fetch('/api/tiktok', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ url }) });
      const data = await resp.json();
      if(!resp.ok) throw new Error(data?.error || 'Gagal mengambil video.');
      result.innerHTML = '<p>Video ditemukan!</p><a class="btn" href="'+data.downloadUrl+'" target="_blank" rel="noopener noreferrer" download>Klik untuk unduh</a>';
    } catch(err){
      console.error(err);
      result.innerText = 'Error: ' + (err.message || err);
    }
  });

  document.getElementById('tiktok-clear').addEventListener('click', ()=>{
    document.getElementById('tiktok-url').value=''; document.getElementById('tiktok-result').innerText='Hasil akan tampil di sini.';
  });

  // AI Chat (Gemini)
  document.getElementById('ai-submit').addEventListener('click', async ()=>{
    const prompt = document.getElementById('ai-prompt').value.trim();
    const resDiv = document.getElementById('ai-result');
    if(!prompt){ resDiv.innerText = 'Masukkan prompt terlebih dahulu.'; return; }
    resDiv.innerText = 'AI sedang berpikir...';
    try {
      const resp = await fetch('/api/gemini', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ prompt }) });
      const data = await resp.json();
      if(!resp.ok) throw new Error(data?.reply || 'Gagal menghubungi AI.');
      resDiv.innerText = data.reply || 'Tidak ada balasan dari AI.';
    } catch(err){
      console.error(err);
      resDiv.innerText = 'Error: ' + (err.message || err);
    }
  });

  document.getElementById('ai-clear').addEventListener('click', ()=>{
    document.getElementById('ai-prompt').value=''; document.getElementById('ai-result').innerText='Belum ada prompt.';
  });

}); // DOMContentLoaded
</script>

</body>
</html>
